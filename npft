#!/bin/bash

PORT=/dev/ttyUSB0;

Partitions() 
{
	echo "All partitions:
1) sbl1         14) cmnlib64       27) modemst1   40) mcfg        
2) sbl1bak      15) cmnlib64bak    28) modemst2   41) apdp 
3) rpm          16) keymaster      29) misc       42) msadp
4) rpmbak       17) keymasterbak   30) batweak    43) dpo   
5) tz           18) aboot          31) cache      44) logdump 
6) tzbak        19) abootbak       32) sec        45) ztecfg 
7) devcfg       20) boot           33) keystore   46) fsg
8) devcfgbak    21) recovery       34) config     47) devinfo 
9) dsp          22) modem          35) oem        48) splash 
10) DDR         23) factory        36) mota       49) fingerid
11) limits      24) ssd            37) dip        50) system 
12) cmnlib      25) fsc            38) mdtp       51) vendor
13) cmnlibbak   26) persist        39) syscfg     52) userdata"
}

PORT_Search() 
{
	echo "Diagnostic port : "$PORT" : Seaching..."
        while [ ! -c $PORT ]
        do
           sleep 1
        done
    echo "Diagnostic port : "$PORT" : Done!"
    echo "Your port: "$PORT
}

VER="1.4"

while [[ $menu != 11 ]]
do
echo "PFT Linux v"$VER" by Zalexanninev15"
echo
echo "************************************"
echo "*                                  *"
echo "*        Choose a command:         *"
echo "*                                  *"
echo "*        1) DFU üëâÔ∏è EDL             *"
echo "*        2) ADB üëâÔ∏è EDL             *"
echo "*     3) Search Diagnostic port    *"
echo "*                                  *"
echo "*        4) All partitions         *"
echo "*       5) Backup partition        *"
echo "*        6) Flash partition        *"
echo "*  7) Backup all partitions (SOON) *"
echo "*                                  *"
echo "*     8) Stop ModemManager         *"
echo "*(for more stable work in EDL mode)*"
echo "* 9) Add user to \"dialout\" group   *"
echo "*                                  *"
echo "*   10) Disable Google FRP (SOON)  *"
echo "*          11) Exit                *"
echo "*                                  *"
echo "************************************"
read menu
echo

if [[ $menu = 1 ]] 
then
  echo "DFU üëâÔ∏è EDL" 
  emmcdl -p $PORT -raw 0xFE
  echo "OK!"
fi

if [[ $menu = 2 ]]
then
	echo "ADB üëâÔ∏è EDL"
	adb reboot edl
	echo "OK!"
fi

if [[ $menu = 3 ]]
then
   echo "You have a "$PORT" ? (Seach/No(I have other port))"
   read SN
   if [[ $SN = S || $SN = s ]]
   then 
       PORT_Search;
  fi
  if [[ $SN = N || $SN = n ]]
  then 
  	echo "Please, write your ttyUSB* - where * is the number (usually \"0\") that you need to enter:"
  	read PORTN
  	PORT="/dev/ttyUSB"$PORTN
  	PORT_Search;
  fi
fi

if [[ $menu = 4 ]] 
then
   Partitions;
fi

if [[ $menu = 5 ]]
then
   echo "Write name of partition (also called file without extension) from item \"3\":"
   read PAR
   emmcdl -p $PORT -f tools/emmc.mbn -d $PAR -o tools/${PAR}_bak.bin
   echo "Partition "$PAR" dumped in file: tools/"$PAR"_bak.bin"
fi

if [[ $menu = 6 ]] # SOON!
then
   echo "Write name of partition (also called file without extension) from item \"3\":"
   read PAR
   emmcdl -p $PORT -f tools/emmc.mbn -b $par tools/${PAR}.bin
   echo "File tools/"$PAR"_bak.bin flashed in partition "$PAR
fi

if [[ $menu = 7 ]] # SOON!
then
   menu="0"
fi

if [[ $menu = 8 ]]
then 
   echo "Please, write your password for stop ModemManager:"
   sudo systemctl stop ModemManager
   echo "OK!"
fi

if [[ $menu = 9 ]]
then
	echo "Add user to \"dialout\" group"
    sudo adduser ${LOGNAME:-$USER} dialout
    echo "Re-login please"
fi

if [[ $menu = 10 ]] # SOON!
then
   menu="0"
fi
echo
read -r -p '-- Press Enter to continue --'
echo

done